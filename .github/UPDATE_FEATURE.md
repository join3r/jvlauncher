# Auto-Update Feature Quick Reference

## ⚠️ IMPORTANT: Configuration Required

Before the auto-update feature will work, you **MUST** update the GitHub username in `src-tauri/tauri.conf.json`:

```json
{
  "plugins": {
    "updater": {
      "endpoints": [
        "https://github.com/YOUR_USERNAME/jvlauncher/releases/latest/download/latest.json"
      ]
    }
  }
}
```

**Replace `YOUR_USERNAME` with your actual GitHub username!**

## What Was Added

### Backend (Rust)
- ✅ `tauri-plugin-updater` dependency
- ✅ `src-tauri/src/updater.rs` - Update logic module
- ✅ Update commands registered in `main.rs`
- ✅ Automatic startup update check (5 second delay)
- ✅ Update permissions in `tauri.conf.json`

### Frontend (JavaScript/HTML)
- ✅ Update UI in Settings window
- ✅ "Check for Updates" button
- ✅ Update status display
- ✅ Release notes viewer
- ✅ "Download & Install" button
- ✅ Event listener for update notifications

## How Users Will Experience It

### Automatic Check (Background)
1. User launches app
2. After 5 seconds, app silently checks for updates
3. If update available, status shows in Settings
4. No interruption to workflow

### Manual Check (Settings)
1. User opens Settings (⋮ button)
2. Scrolls to "Updates" section
3. Clicks "Check for Updates"
4. Sees:
   - Current version
   - Latest version (if available)
   - Release notes
   - "Download & Install" button

### Installing Update
1. User clicks "Download & Install"
2. App downloads update in background
3. Shows progress/status
4. Prompts to restart when complete
5. User restarts app
6. New version is running!

## For Developers

### Creating a Release with Updates

1. **Update version:**
   ```bash
   # Edit src-tauri/tauri.conf.json
   # Change "version": "0.1.0" to "0.2.0"
   ```

2. **Commit and push:**
   ```bash
   git add src-tauri/tauri.conf.json
   git commit -m "Bump version to 0.2.0"
   git push origin master
   ```

3. **Run GitHub Actions:**
   - Go to Actions tab
   - Click "Release macOS"
   - Run workflow on `master` branch

4. **Publish release:**
   - Review draft release
   - Click "Publish release"

5. **Users get updated:**
   - Automatic notification on next launch
   - Or manual check in Settings

## Files Modified

```
src-tauri/
├── Cargo.toml                 # Added tauri-plugin-updater
├── tauri.conf.json           # Added updater config & permissions
├── src/
│   ├── main.rs               # Registered updater plugin & commands
│   └── updater.rs            # NEW: Update logic

dist/
├── settings.html             # Added update UI section
└── settings.js               # Added update functions

.github/
└── workflows/
    └── release.yml           # Already configured to generate latest.json

AUTO_UPDATE_SETUP.md          # NEW: Comprehensive setup guide
```

## Testing the Feature

### Before First Release

The update feature won't work until you:
1. Replace `YOUR_USERNAME` in `tauri.conf.json`
2. Create and publish at least one release
3. The release must include `latest.json` (auto-generated by workflow)

### After First Release

1. Install the released version
2. Bump version number locally
3. Create a new release
4. Launch the installed app
5. Check Settings → Updates
6. Should see new version available

## Update Flow Diagram

```
App Launch
    ↓
Wait 5 seconds
    ↓
Check GitHub for latest.json
    ↓
Compare versions
    ↓
┌─────────────┬─────────────┐
│ Up to date  │ Update      │
│             │ available   │
└─────────────┴─────────────┘
                    ↓
            Emit event to frontend
                    ↓
            Show in Settings UI
                    ↓
            User clicks "Install"
                    ↓
            Download DMG
                    ↓
            Install update
                    ↓
            Prompt restart
                    ↓
            User restarts
                    ↓
            New version running!
```

## Troubleshooting

### "Failed to check for updates"
- Check GitHub username in config
- Verify release is published
- Check internet connection

### "No update available" (but there is one)
- Check version number format (must be semver)
- Verify `latest.json` exists in release
- Clear app cache and try again

### Update downloads but won't install
- Check macOS security settings
- Verify app has write permissions
- Try running with admin privileges

## Next Steps

1. ✅ Replace `YOUR_USERNAME` in `tauri.conf.json`
2. ✅ Test the build: `./build.sh`
3. ✅ Create your first release via GitHub Actions
4. ✅ Test update flow with a second release
5. ✅ Consider adding code signing for production

## Documentation

- **Full Setup Guide:** `AUTO_UPDATE_SETUP.md`
- **GitHub Actions:** `.github/workflows/README.md`
- **Tauri Docs:** https://v2.tauri.app/plugin/updater/

---

**Remember:** The update feature requires at least one published release to work!

